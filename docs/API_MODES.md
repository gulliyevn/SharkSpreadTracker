# API –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ä–µ–∂–∏–º–∞–º —Ä–∞–±–æ—Ç—ã API –∞–¥–∞–ø—Ç–µ—Ä–∞ –≤ Shark Spread Tracker.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
- [–†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã](#—Ä–µ–∂–∏–º—ã-—Ä–∞–±–æ—Ç—ã)
  - [direct](#direct)
  - [backend](#backend)
  - [hybrid](#hybrid)
  - [auto](#auto)
- [–ù–∞—Å—Ç—Ä–æ–π–∫–∞](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
- [–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ](#–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ-–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ)
- [Circuit Breaker](#circuit-breaker)
- [–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ](#–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [Edge Cases](#edge-cases)

---

## –û–±–∑–æ—Ä

API Adapter –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–Ω–µ—à–Ω–∏–º–∏ API (Jupiter, PancakeSwap, MEXC) –∏ –±—ç–∫–µ–Ω–¥–æ–º. –ê–¥–∞–ø—Ç–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏ —Ä–∞–±–æ—Ç—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –±—ç–∫–µ–Ω–¥–∞, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –±–µ—Å–ø–µ—Ä–µ–±–æ–π–Ω—É—é —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **–†–∞–±–æ—Ç–∞ –±–µ–∑ –±—ç–∫–µ–Ω–¥–∞** - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø—Ä—è–º—ã–º–∏ –≤—ã–∑–æ–≤–∞–º–∏ –∫ –≤–Ω–µ—à–Ω–∏–º API
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ** - –Ω–µ–∑–∞–º–µ—Ç–Ω–æ–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏
- ‚úÖ **Fallback –º–µ—Ö–∞–Ω–∏–∑–º** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –ø—Ä—è–º—ã–µ API –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –±—ç–∫–µ–Ω–¥–∞
- ‚úÖ **Circuit Breaker** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–π
- ‚úÖ **Health Check** - –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –±—ç–∫–µ–Ω–¥–∞
- ‚úÖ **–ö—ç—à –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Ä–µ–∂–∏–º–æ–≤

---

## –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

### direct

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã –∫ –≤–Ω–µ—à–Ω–∏–º API –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±—ç–∫–µ–Ω–¥–∞.

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –±–µ–∑ –±—ç–∫–µ–Ω–¥–∞
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä—è–º—ã—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
- –†–∞–±–æ—Ç–∞ –≤ offline —Ä–µ–∂–∏–º–µ
- –ö–æ–≥–¥–∞ –±—ç–∫–µ–Ω–¥ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç –Ω–∞–ø—Ä—è–º—É—é –∫ Jupiter, PancakeSwap, MEXC
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –±—ç–∫–µ–Ω–¥
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (–Ω–µ—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —Å–ª–æ—è)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ rate limit –≤–Ω–µ—à–Ω–∏—Ö API

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
```bash
VITE_API_MODE=direct
```

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```typescript
import { getAllTokens } from '@/api/adapters/api-adapter';

// –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä—è–º—ã–µ API –≤—ã–∑–æ–≤—ã
const tokens = await getAllTokens();
```

---

### backend

**–û–ø–∏—Å–∞–Ω–∏–µ:** –í—ã–∑–æ–≤—ã —á–µ—Ä–µ–∑ –±—ç–∫–µ–Ω–¥ API Gateway —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º fallback –Ω–∞ direct –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö.

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- Production —Å –±—ç–∫–µ–Ω–¥–æ–º
- –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
- –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –±—ç–∫–µ–Ω–¥–µ
- –î–ª—è rate limiting –Ω–∞ –±—ç–∫–µ–Ω–¥–µ

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç —á–µ—Ä–µ–∑ –±—ç–∫–µ–Ω–¥
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ direct –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –±—ç–∫–µ–Ω–¥–∞
- Circuit Breaker –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
- Health check –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ backend –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
```bash
VITE_API_MODE=backend
VITE_BACKEND_URL=https://api.your-backend.com
```

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```typescript
import { getAllTokens } from '@/api/adapters/api-adapter';

// –ü—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±—ç–∫–µ–Ω–¥, –ø—Ä–∏ –æ—à–∏–±–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ direct
const tokens = await getAllTokens();
```

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö:**
1. –ó–∞–ø—Ä–æ—Å –∫ –±—ç–∫–µ–Ω–¥—É
2. –ü—Ä–∏ –æ—à–∏–±–∫–µ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ direct
3. –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ React Query
4. –ü—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –±—ç–∫–µ–Ω–¥–∞ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ

---

### hybrid

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ë—ç–∫–µ–Ω–¥ —Å Circuit Breaker –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º fallback –Ω–∞ direct –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö.

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ö–æ–≥–¥–∞ –Ω—É–∂–µ–Ω –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π fallback –º–µ—Ö–∞–Ω–∏–∑–º
- –î–ª—è production —Å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–º –±—ç–∫–µ–Ω–¥–æ–º
- –ö–æ–≥–¥–∞ –Ω—É–∂–µ–Ω –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ fallback –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –±—ç–∫–µ–Ω–¥ –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫
- Circuit Breaker —Å –ø–æ—Ä–æ–≥–æ–º 3 –æ—à–∏–±–∫–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ direct –ø—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏ Circuit Breaker
- –ú–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å fallback —á–µ—Ä–µ–∑ `VITE_API_FALLBACK_ENABLED=false`
- Health check –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
```bash
VITE_API_MODE=hybrid
VITE_BACKEND_URL=https://api.your-backend.com
VITE_API_FALLBACK_ENABLED=true  # –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
```

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```typescript
import { getAllTokens } from '@/api/adapters/api-adapter';

// –ò—Å–ø–æ–ª—å–∑—É–µ—Ç hybrid –ª–æ–≥–∏–∫—É —Å Circuit Breaker
const tokens = await getAllTokens();
```

**Circuit Breaker –ª–æ–≥–∏–∫–∞:**
- –ü–æ—Å–ª–µ 3 –æ—à–∏–±–æ–∫ –ø–æ–¥—Ä—è–¥ ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ direct
- –ß–µ—Ä–µ–∑ 60 —Å–µ–∫—É–Ω–¥ ‚Üí –ø–æ–ø—ã—Ç–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ ‚Üí —Å–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–∞

---

### auto

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –±—ç–∫–µ–Ω–¥–∞.

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –≥–∏–±–∫–æ—Å—Ç–∏
- –ö–æ–≥–¥–∞ –±—ç–∫–µ–Ω–¥ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏
- –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –±—ç–∫–µ–Ω–¥–∞ —á–µ—Ä–µ–∑ `/health`
- –ï—Å–ª–∏ –±—ç–∫–µ–Ω–¥ –¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `BackendApiAdapter` —Å fallback
- –ï—Å–ª–∏ –±—ç–∫–µ–Ω–¥ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `DirectApiAdapter`
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
```bash
VITE_API_MODE=auto
VITE_BACKEND_URL=https://api.your-backend.com
```

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```typescript
import { getAllTokens } from '@/api/adapters/api-adapter';

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º
const tokens = await getAllTokens();
```

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:**
1. –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ `/health` endpoint
2. –ï—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí `BackendApiAdapter` —Å fallback
3. –ï—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí `DirectApiAdapter`
4. –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
5. –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∫—ç—à–∞

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ |
|-----------|----------|--------------|-------------|
| `VITE_API_MODE` | –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã API | `direct` | –ù–µ—Ç |
| `VITE_BACKEND_URL` | URL –±—ç–∫–µ–Ω–¥–∞ | `https://api.your-backend.com` | –î–∞ (–¥–ª—è backend/hybrid/auto) |
| `VITE_API_FALLBACK_ENABLED` | –í–∫–ª—é—á–∏—Ç—å fallback –≤ hybrid —Ä–µ–∂–∏–º–µ | `true` | –ù–µ—Ç |

### –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**Development (–±–µ–∑ –±—ç–∫–µ–Ω–¥–∞):**
```bash
VITE_API_MODE=direct
```

**Production (—Å –±—ç–∫–µ–Ω–¥–æ–º):**
```bash
VITE_API_MODE=backend
VITE_BACKEND_URL=https://api.production.com
```

**Production (–≥–∏–±—Ä–∏–¥–Ω—ã–π —Ä–µ–∂–∏–º):**
```bash
VITE_API_MODE=hybrid
VITE_BACKEND_URL=https://api.production.com
VITE_API_FALLBACK_ENABLED=true
```

**Production (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º):**
```bash
VITE_API_MODE=auto
VITE_BACKEND_URL=https://api.production.com
```

---

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
   - –í —Ä–µ–∂–∏–º–µ `auto` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –±—ç–∫–µ–Ω–¥–∞
   - –í—ã–±–∏—Ä–∞–µ—Ç—Å—è –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –∞–¥–∞–ø—Ç–µ—Ä

2. **–í–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:**
   - –í —Ä–µ–∂–∏–º–∞—Ö `backend`, `hybrid`, `auto` –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `/health`
   - –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ

3. **–ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö:**
   - –í —Ä–µ–∂–∏–º–∞—Ö `backend` –∏ `hybrid` –ø—Ä–∏ –æ—à–∏–±–∫–µ –∑–∞–ø—Ä–æ—Å–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç fallback –Ω–∞ direct
   - Circuit Breaker –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å backend –Ω–∞ direct

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- –û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ –±—ç–∫–µ–Ω–¥—É
- –ú–µ–¥–ª–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç (> 3 —Å–µ–∫—É–Ω–¥)
- Circuit Breaker —Å—Ä–∞–±–æ—Ç–∞–ª (3 –æ—à–∏–±–∫–∏ –ø–æ–¥—Ä—è–¥)
- Health check –ø–æ–∫–∞–∑–∞–ª –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ React Query (tokens, prices, spreads)
2. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ DirectApiAdapter
3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è (–≤ dev —Ä–µ–∂–∏–º–µ)

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å direct –Ω–∞ backend

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- Health check –ø–æ–∫–∞–∑–∞–ª –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –±—ç–∫–µ–Ω–¥–∞
- –ü—Ä–æ—à–ª–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—à–∏–±–∫–∏ (60 —Å–µ–∫—É–Ω–¥ –¥–ª—è Circuit Breaker)

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ React Query
2. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ BackendApiAdapter
3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è (–≤ dev —Ä–µ–∂–∏–º–µ)

---

## Circuit Breaker

Circuit Breaker –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏ –ø—Ä–∏ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–º –±—ç–∫–µ–Ω–¥–µ.

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

- **Failure Threshold:** 3 –æ—à–∏–±–∫–∏ –ø–æ–¥—Ä—è–¥
- **Reset Timeout:** 60 —Å–µ–∫—É–Ω–¥
- **Slow Response Threshold:** 3 —Å–µ–∫—É–Ω–¥—ã

### –°–æ—Å—Ç–æ—è–Ω–∏—è

1. **Closed (–ó–∞–∫—Ä—ã—Ç):** –ù–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞, –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç –∫ –±—ç–∫–µ–Ω–¥—É
2. **Open (–û—Ç–∫—Ä—ã—Ç):** –ü–æ—Å–ª–µ 3 –æ—à–∏–±–æ–∫ ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ direct
3. **Half-Open (–ü–æ–ª—É–æ—Ç–∫—Ä—ã—Ç):** –ß–µ—Ä–µ–∑ 60 —Å–µ–∫—É–Ω–¥ ‚Üí –ø–æ–ø—ã—Ç–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

```typescript
// –ü–æ—Å–ª–µ 3 –æ—à–∏–±–æ–∫ –ø–æ–¥—Ä—è–¥
if (failures >= 3) {
  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ fallback
  useFallback = true;
  
  // –ß–µ—Ä–µ–∑ 60 —Å–µ–∫—É–Ω–¥ –ø–æ–ø—ã—Ç–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
  setTimeout(() => {
    failures = 0; // –°–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–∞
  }, 60000);
}

// –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ
if (success) {
  failures = 0; // –°–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–∞
}
```

---

## –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞

–ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Ä–µ–∂–∏–º–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –∫—ç—à React Query:

- **Tokens cache** - `['tokens']`
- **Prices cache** - `['prices']`
- **Spreads cache** - `['spread']`

–≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞.

### –ö–æ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è

- –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Å backend –Ω–∞ direct
- –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Å direct –Ω–∞ backend
- –ü—Ä–∏ fallback –Ω–∞ direct –≤ —Ä–µ–∂–∏–º–∞—Ö backend/hybrid

---

## Edge Cases

### –ú–µ–¥–ª–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –±—ç–∫–µ–Ω–¥–∞

–ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –æ—Ç –±—ç–∫–µ–Ω–¥–∞ –∑–∞–Ω–∏–º–∞–µ—Ç –±–æ–ª–µ–µ 3 —Å–µ–∫—É–Ω–¥:
- –ó–∞–ø—Ä–æ—Å —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–µ—É–¥–∞—á–Ω—ã–º
- –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç fallback –Ω–∞ direct
- Circuit Breaker –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É

### Offline —Ä–µ–∂–∏–º

–ü—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ offline —Ä–µ–∂–∏–º–∞ (`navigator.onLine === false`):
- Health check –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è
- –ó–∞–ø—Ä–æ—Å—ã –∫ –±—ç–∫–µ–Ω–¥—É –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è direct —Ä–µ–∂–∏–º

### –ß–∞—Å—Ç–∏—á–Ω–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –±—ç–∫–µ–Ω–¥–∞

–ï—Å–ª–∏ `/health` endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ API endpoints –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç:
- Health check –ø–æ–∫–∞–∂–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
- –ù–æ –∑–∞–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –ø–∞–¥–∞—Ç—å
- Circuit Breaker —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å–ª–µ 3 –æ—à–∏–±–æ–∫
- –ü—Ä–æ–∏–∑–æ–π–¥–µ—Ç fallback –Ω–∞ direct

### –¢–∞–π–º–∞—É—Ç—ã

- **Health check:** 5 —Å–µ–∫—É–Ω–¥
- **API –∑–∞–ø—Ä–æ—Å—ã:** 3 —Å–µ–∫—É–Ω–¥—ã (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `AbortSignal.timeout()`)

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```typescript
import { getAllTokens, getAllPrices, getSpreadData } from '@/api/adapters/api-adapter';

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
const tokens = await getAllTokens();

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω
const prices = await getAllPrices({ symbol: 'BTC', chain: 'solana' });

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø—Ä–µ–¥–æ–≤
const spread = await getSpreadData({ symbol: 'BTC', chain: 'solana' }, '1h');
```

### –° AbortSignal

```typescript
import { getAllTokens } from '@/api/adapters/api-adapter';

const controller = new AbortController();

// –û—Ç–º–µ–Ω–∞ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
setTimeout(() => controller.abort(), 5000);

try {
  const tokens = await getAllTokens(controller.signal);
} catch (error) {
  if (error.name === 'AbortError') {
    console.log('Request cancelled');
  }
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –±—ç–∫–µ–Ω–¥–∞

```typescript
import { checkBackendHealth } from '@/api/adapters/api-adapter';

const isHealthy = await checkBackendHealth();
console.log(`Backend is ${isHealthy ? 'available' : 'unavailable'}`);
```

---

## –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í development —Ä–µ–∂–∏–º–µ (`import.meta.env.DEV === true`) –≤—Å–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:

```typescript
logger.info('[ApiAdapter] Auto mode: Backend recovered, switching back to BackendApiAdapter');
logger.warn('[BackendApiAdapter] Backend failed, auto-switching to direct');
logger.debug('[checkBackendHealth] Health check failed');
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Ä–µ–∂–∏–º–∞

```typescript
import { API_MODE, BACKEND_URL } from '@/api/adapters/api-adapter';

console.log(`Current mode: ${API_MODE}`);
console.log(`Backend URL: ${BACKEND_URL}`);
```

---

## FAQ

### –ö–∞–∫–æ–π —Ä–µ–∂–∏–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ production?

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `backend` –∏–ª–∏ `auto` —Ä–µ–∂–∏–º –¥–ª—è production —Å –±—ç–∫–µ–Ω–¥–æ–º.

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –±—ç–∫–µ–Ω–¥–∞?

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ direct —Ä–µ–∂–∏–º –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –±—ç–∫–µ–Ω–¥–∞.

### –ö–∞–∫ —á–∞—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∑–¥–æ—Ä–æ–≤—å–µ –±—ç–∫–µ–Ω–¥–∞?

–ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ –≤ —Ä–µ–∂–∏–º–∞—Ö `backend`, `hybrid`, `auto`.

### –ú–æ–∂–Ω–æ –ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å fallback?

–î–∞, –≤ hybrid —Ä–µ–∂–∏–º–µ –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `VITE_API_FALLBACK_ENABLED=false`.

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –∫—ç—à–µ–º –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏?

–ö—ç—à React Query –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Ä–µ–∂–∏–º–æ–≤.

---

## –°–º. —Ç–∞–∫–∂–µ

- [API Adapter Source Code](../src/api/adapters/api-adapter.ts)
- [Cache Utils](../src/utils/cache-utils.ts)
- [Backend Health Monitor](../src/utils/backend-health.ts)

